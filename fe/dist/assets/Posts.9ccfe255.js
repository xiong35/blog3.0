var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;"undefined"!=typeof require&&require;import{r,_ as n,j as i,i as u,a as d,d as p,P as v}from"./index.6bc7d1ed.js";import{d as m,c as f,e as _,a as w,t as y,q as b,s as g,F as h}from"./vendor.dcc053a3.js";import{h as D,d as k}from"./hot.5d6d7e75.js";var j=m({name:"CEmpty",setup:e=>()=>f("div",{class:"c-empty"},[f("span",{class:"c-empty_hint"},[_("什么都没有，该有什么呢")]),f("div",{class:"c-empty_decorate"},null)])}),C=m({name:"CPostCard",props:{post:{type:Object,required:!0}},setup(e){const{post:t}=e;return()=>f("article",{class:"c-postcard",onMouseenter:()=>u.value=!0,onMouseleave:()=>u.value=!1,onClick:e=>i(e,{name:"post-detail",params:{id:t._id}})},[f("div",{class:"c-postcard_content"},[f("title",{class:"c-postcard_title","data-text":t.title},[t.title]),f("div",{class:"c-postcard_hot"},[f("img",{src:D,alt:"hot",class:"c-postcard_hot-icon"},null),f("span",{class:"c-postcard_hot-count"},[t.visited])]),f("div",{class:"c-postcard_digest"},[t.digest]),f("div",{class:"c-postcard_tags"},[t.tags.map((e=>f(n,{class:"c-postcard_tags-tag",name:e.name,key:e._id,onClick:t=>{i(t,{name:"posts",query:{kw:e.name}})}},null)))]),f("div",{class:"c-postcard_time u-only-big"},[k(new Date(t.updatedAt))])]),f("div",{class:"c-postcard_decorate"},[f("div",{class:"c-postcard_decorate-item c-postcard_decorate-Alice"},null),f("div",{class:"c-postcard_decorate-item c-postcard_decorate-Bob"},null),f("div",{class:"c-postcard_decorate-item c-postcard_decorate-Candy"},null)])])}}),O=m({name:"CPostList",props:{fromDate:Number,toDate:Number,page:Number,kw:String},setup(e){const n=w([]),i=y(e,"kw");b(i,(()=>{n.value=[],u.value=0,m.value=9999,D.value=0,k.value=Date.now(),O(!0,!0)}));const u=w(-9999),m=w(9999),D=w(e.fromDate||0),k=w(e.toDate||Date.now());async function O(e,d=!1){const p={limit:v};e?p.from=D.value:p.to=k.value,d&&(p.to=k.value,p.from=D.value);const f=await async function(e){return(await r({url:"/post",method:"GET",params:e})).data||[]}((_=((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&c(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&c(e,a,t[a]);return e})({},p),w={kw:i.value},t(_,a(w))));var _,w;if(f&&f.length){if(n.value=f,k.value=new Date(f[0].updatedAt).getTime(),D.value=new Date(f[f.length-1].updatedAt).getTime(),d||(e?u.value++:u.value--),f.length!==v){if(!e)return D.value=0,k.value=Date.now(),u.value=0,void(await O(!0,!0));m.value=u.value}}else e?m.value=u.value:u.value=0}return g((()=>{history.pushState({},"",window.location.href.split("?")[0]+`?fromDate=${D.value}&toDate=${k.value}${i.value?"&kw="+i.value:""}`)})),O(!0,!0),()=>f("div",{class:"c-post-list"},[f("div",{class:"c-post-list_posts"},[n.value.length?f(h,null,[n.value.map((e=>f(C,{class:"c-post-list_posts-postcard",post:e,key:e._id},null)))]):f(j,{style:{margin:"10vh auto"}},null)]),f("div",{class:"c-post-list_pager"},[f(d,{content:"第 0 页",onClick:()=>{D.value=0,k.value=Date.now(),u.value=0,O(!0,!0).then((()=>p()))}},null),f("div",{class:"u-spacer"},[_(" ")]),f(d,{content:"上一页",disabled:0===u.value,onClick:()=>O(!1).then((()=>p()))},null),f(d,{content:"下一页",disabled:u.value===m.value,onClick:()=>O(!0).then((()=>p()))},null)])])}}),P=m({name:"Posts",props:{fromDate:Number,toDate:Number,kw:String},setup(e){const{fromDate:t,toDate:a}=e,s=y(e,"kw");return()=>f("div",{class:"p-posts"},[f("title",{class:"p-posts_title"},[s.value?`搜索“${s.value}”的结果`:"文章列表"]),f(O,{fromDate:t,toDate:a,kw:s.value},null)])}});export{P as default};
