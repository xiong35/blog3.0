var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;"undefined"!=typeof require&&require;import{r as c,_ as n,j as u,i,a as d,d as p,P as v}from"./index.6dbee3a0.js";import{_ as m}from"./CEmpty.vue_vue&type=style&index=0&lang.818475af.js";import{h as f,d as _}from"./hot.5d6d7e75.js";import{d as w,c as g,a as b,t as y,q as D,s as h,F as k,e as j}from"./vendor.dcc053a3.js";var C=w({name:"CPostCard",props:{post:{type:Object,required:!0}},setup(e){const{post:t}=e;return()=>g("article",{class:"c-postcard",onMouseenter:()=>i.value=!0,onMouseleave:()=>i.value=!1,onClick:e=>u(e,{name:"post-detail",params:{id:t._id}})},[g("div",{class:"c-postcard_content"},[g("title",{class:"c-postcard_title","data-text":t.title},[t.title]),g("div",{class:"c-postcard_hot"},[g("img",{src:f,alt:"hot",class:"c-postcard_hot-icon"},null),g("span",{class:"c-postcard_hot-count"},[t.visited])]),g("div",{class:"c-postcard_digest"},[t.digest]),g("div",{class:"c-postcard_tags"},[t.tags.map((e=>g(n,{class:"c-postcard_tags-tag",name:e.name,key:e._id,onClick:t=>{u(t,{name:"posts",query:{kw:e.name}})}},null)))]),g("div",{class:"c-postcard_time u-only-big"},[_(new Date(t.updatedAt))])]),g("div",{class:"c-postcard_decorate"},[g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Alice"},null),g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Bob"},null),g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Candy"},null)])])}}),O=w({name:"CPostList",props:{fromDate:Number,toDate:Number,page:Number,kw:String},setup(e){const n=b([]),u=y(e,"kw");D(u,(()=>{n.value=[],i.value=0,f.value=9999,_.value=0,w.value=Date.now(),O(!0,!0)}));const i=b(-9999),f=b(9999),_=b(e.fromDate||0),w=b(e.toDate||Date.now());async function O(e,d=!1){const p={limit:v};e?p.from=_.value:p.to=w.value,d&&(p.to=w.value,p.from=_.value);const m=await async function(e){return(await c({url:"/post",method:"GET",params:e})).data||[]}((g=((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&r(e,a,t[a]);return e})({},p),b={kw:u.value},t(g,a(b))));var g,b;if(m&&m.length){if(n.value=m,w.value=new Date(m[0].updatedAt).getTime(),_.value=new Date(m[m.length-1].updatedAt).getTime(),d||(e?i.value++:i.value--),m.length!==v){if(!e)return _.value=0,w.value=Date.now(),i.value=0,void(await O(!0,!0));f.value=i.value}}else e?f.value=i.value:i.value=0}return h((()=>{history.pushState({},"",window.location.href.split("?")[0]+`?fromDate=${_.value}&toDate=${w.value}${u.value?"&kw="+u.value:""}`)})),O(!0,!0),()=>g("div",{class:"c-post-list"},[g("div",{class:"c-post-list_posts"},[n.value.length?g(k,null,[n.value.map((e=>g(C,{class:"c-post-list_posts-postcard",post:e,key:e._id},null)))]):g(m,{style:{margin:"10vh auto"}},null)]),g("div",{class:"c-post-list_pager"},[g(d,{content:"第 0 页",onClick:()=>{_.value=0,w.value=Date.now(),i.value=0,O(!0,!0).then((()=>p()))}},null),g("div",{class:"u-spacer"},[j(" ")]),g(d,{content:"上一页",disabled:0===i.value,onClick:()=>O(!1).then((()=>p()))},null),g(d,{content:"下一页",disabled:i.value===f.value,onClick:()=>O(!0).then((()=>p()))},null)])])}}),P=w({name:"Posts",props:{fromDate:Number,toDate:Number,kw:String},setup(e){const{fromDate:t,toDate:a}=e,s=y(e,"kw");return()=>g("div",{class:"p-posts"},[g("title",{class:"p-posts_title"},[s.value?`搜索“${s.value}”的结果`:"文章列表"]),g(O,{fromDate:t,toDate:a,kw:s.value},null)])}});export{P as default};
