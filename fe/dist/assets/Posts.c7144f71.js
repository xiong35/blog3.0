var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;"undefined"!=typeof require&&require;import{r as c,c as n,j as u,i,f as d,_ as p,h as v,P as m}from"./index.cb1502e5.js";import{h as f,d as w}from"./hot.5d6d7e75.js";import{d as _,c as g,a as b,t as h,s as D,u as y,F as k,e as j}from"./vendor.352936e6.js";var O=_({name:"CPostCard",props:{post:{type:Object,required:!0}},setup(e){const{post:t}=e;return()=>g("article",{class:"c-postcard",onMouseenter:()=>i.value=!0,onMouseleave:()=>i.value=!1,onClick:e=>u(e,{name:"post-detail",params:{id:t._id}})},[g("div",{class:"c-postcard_content"},[g("title",{class:"c-postcard_title","data-text":t.title},[t.title]),g("div",{class:"c-postcard_hot"},[g("img",{src:f,alt:"hot",class:"c-postcard_hot-icon"},null),g("span",{class:"c-postcard_hot-count"},[t.visited])]),g("div",{class:"c-postcard_digest"},[t.digest]),g("div",{class:"c-postcard_tags"},[t.tags.map((e=>g(n,{class:"c-postcard_tags-tag",name:e.name,key:e._id,onClick:t=>{u(t,{name:"posts",query:{kw:e.name}})}},null)))]),g("div",{class:"c-postcard_time u-only-big"},[w(new Date(t.updatedAt))])]),g("div",{class:"c-postcard_decorate"},[g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Alice"},null),g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Bob"},null),g("div",{class:"c-postcard_decorate-item c-postcard_decorate-Candy"},null)])])}}),C=_({name:"CPostList",props:{fromDate:Number,toDate:Number,page:Number,kw:String},setup(e){const n=b([]),u=h(e,"kw");D(u,(()=>{n.value=[],i.value=0,f.value=9999,w.value=0,_.value=Date.now(),C(!0,!0)}));const i=b(-9999),f=b(9999),w=b(e.fromDate||0),_=b(e.toDate||Date.now());async function C(e,d=!1){const p={limit:m};e?p.from=w.value:p.to=_.value,d&&(p.to=_.value,p.from=w.value);const v=await async function(e){return(await c({url:"/post",method:"GET",params:e})).data||[]}((g=((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&r(e,a,t[a]);return e})({},p),b={kw:u.value},t(g,a(b))));var g,b;if(v&&v.length){if(n.value=v,_.value=new Date(v[0].updatedAt).getTime(),w.value=new Date(v[v.length-1].updatedAt).getTime(),d||(e?i.value++:i.value--),v.length!==m){if(!e)return w.value=0,_.value=Date.now(),i.value=0,void(await C(!0,!0));f.value=i.value}}else e?f.value=i.value:i.value=0}return y((()=>{history.pushState({},"",window.location.href.split("?")[0]+`?fromDate=${w.value}&toDate=${_.value}${u.value?"&kw="+u.value:""}`)})),C(!0,!0),()=>g("div",{class:"c-post-list"},[g("div",{class:"c-post-list_posts"},[n.value.length?g(k,null,[n.value.map((e=>g(O,{class:"c-post-list_posts-postcard",post:e,key:e._id},null)))]):g(d,{msg:"什么都没有, 该有什么呢",style:{margin:"10vh auto"}},null)]),g("div",{class:"c-post-list_pager"},[g(p,{content:"第 0 页",onClick:()=>{w.value=0,_.value=Date.now(),i.value=0,C(!0,!0).then((()=>v()))}},null),g("div",{class:"u-spacer"},[j(" ")]),g(p,{content:"上一页",disabled:0===i.value,onClick:()=>C(!1).then((()=>v()))},null),g(p,{content:"下一页",disabled:i.value===f.value,onClick:()=>C(!0).then((()=>v()))},null)])])}}),P=_({name:"Posts",props:{fromDate:Number,toDate:Number,kw:String},setup(e){const{fromDate:t,toDate:a}=e,s=h(e,"kw");return()=>g("div",{class:"p-posts"},[g("title",{class:"p-posts_title"},[s.value?`搜索“${s.value}”的结果`:"文章列表"]),g(C,{fromDate:t,toDate:a,kw:s.value},null)])}});export{P as default};
